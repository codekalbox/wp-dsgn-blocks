(()=>{"use strict";!function(t){const e={mouseX:0,mouseUp:!1,bindEvents:function(){t(window).on("mousemove",(function(t){e.mouseX=t.clientX})),t(window).on("mouseup",(function(){e.mouseUp=!0,t('#nectar-menu-settings-modal .setting-field[class*="nectar-setting-numerical"]').removeClass("scrubbing").removeClass("no-scrubbing")}))},init:function(){this.bindEvents()}};function n(){this.$modalWrap=t("#nectar-menu-settings-modal-wrap"),this.$modal=t("#nectar-menu-settings-modal"),this.$modalInner=this.$modal.find(".nectar-menu-settings-inner"),this.$form=this.$modal.find(".menu-options-form"),this.$modalOverlay=t("#nectar-menu-settings-overlay"),this.$saveBtn=this.$modal.find(".bottom-controls .save"),this.state={modalOpen:!1,category:"",saving:!1,id:!1},this.saveTimeout=!1,this.createDomEls(),this.modalEvents()}function i(t){this.$el=t,this.$scrubber="",this.$scrubberIndicator="",this.scrubberIndicatorX=0,this.initialX=0,this.calculatedVal=0,this.scrubberCurrent=0,this.currentVal=0,this.zeroFloor=!0,this.ceil=t.parents(".setting-field[data-ceil]").length>0?parseInt(t.parents(".setting-field[data-ceil]").attr("data-ceil")):1e6,this.rateAdjustment=6,this.connectedUnitsEl=this.$el.parents(".setting").find('select[id*="units"]').length>0&&this.$el.parents(".setting").find('select[id*="units"]'),this.events(),this.rateAdjustmentUpdate(),this.createMarkup(),this.scrubbing()}e.init(),n.prototype.createDomEls=function(){t("#menu-to-edit li.menu-item > .menu-item-settings").each((function(){0==t(this).find(".nectar-menu-item-editor").length&&t(this).prepend('<span class="nectar-menu-item-editor">'+nectar_menu_i18n.edit_button_text+"</span>")}))},n.prototype.modalEvents=function(){const e=this;t("body").on("click",".nectar-menu-item-editor",(function(){if(e.state.modelOpen)return!1;const n=t(this).parents(".menu-item"),i=n.attr("id").match(/[0-9]+/);if(!i)return!1;e.state.id=parseInt(i[0],10);const s={parent_id:t(".menu-edit input#menu").val(),menu_item_depth:n.attr("class").match(/\menu-item-depth-(\d+)\b/)[1],menu_item_id:e.state.id,menu_item_name:n.find(".item-title .menu-item-title").text()};e.$modalWrap.addClass("open").addClass("loading"),e.$modalOverlay.addClass("open"),e.$modal.find("> .header .menu-item-name").text(s.menu_item_name),e.$modal.find(".header .categories a").removeClass("hidden"),0==s.menu_item_depth||(1==s.menu_item_depth?e.$modal.find('.header .categories a[data-rel="menu-item"]').addClass("hidden"):s.menu_item_depth>1&&e.$modal.find('.header .categories a[data-rel="mega-menu"]').addClass("hidden")),t.ajax({type:"POST",url:nectar_menu.ajaxurl,data:{action:"nectar_menu_item_settings",menu_item_depth:s.menu_item_depth,menu_item_id:s.menu_item_id,parent_id:s.parent_id,menu_item_name:s.menu_item_name,nonce:nectar_menu.nonce},cache:!1,success:function(t){e.$modalWrap.removeClass("loading"),e.$form.html(t),e.fieldsInit(),e.state.modelOpen=!0;const n=e.$modalWrap.find(".header .categories a:not(.hidden)").first();n.addClass("no-transition").trigger("click"),e.state.category=n.attr("data-rel"),setTimeout((function(){e.$modalWrap.find(".header .categories a.no-transition").removeClass("no-transition")}),100)}})})),t("body").on("click","#nectar-menu-settings-modal .bottom-controls .save",(function(n){if(!e.state.modelOpen||e.state.saving||!e.state.id)return!1;n.preventDefault(),e.state.saving=!0,e.$saveBtn.addClass("saving"),e.$saveBtn.find(".dynamic").text(nectar_menu_i18n.saving);const i=e.$form.serializeFormWithArrs();t.ajax({type:"POST",url:nectar_menu.ajaxurl,data:{action:"nectar_menu_item_settings_save",nonce:nectar_menu.nonce,id:e.state.id,options:i},cache:!1,success:function(t){if(e.state.saving=!1,!t)return!1;e.$saveBtn.removeClass("saving"),"success"===t.type?(e.$saveBtn.addClass("success"),e.$saveBtn.find(".dynamic").text(nectar_menu_i18n.success)):(e.$saveBtn.addClass("error"),e.$saveBtn.find(".dynamic").text(nectar_menu_i18n.error)),e.saveTimeout=setTimeout((function(){e.$saveBtn.removeClass("error").removeClass("success"),e.state.saving=!1}),2500)}})})),t("body").on("click","#nectar-menu-settings-modal .close-modal, #nectar-menu-settings-overlay.open",(function(t){if(e.state.saving)return!1;t.preventDefault(),e.$modal.css({opacity:"0",transform:"scale(0.85)"}),e.$modalOverlay.css({opacity:"0"}),setTimeout((function(){e.$modal.find("> .header .menu-item-name").text(""),e.$form.html(""),e.$modal.css({opacity:"",transform:""}),e.$modalWrap.removeClass("open").addClass("loading"),e.$modalOverlay.css("opacity","").removeClass("open"),e.$modal.find(".header .categories a").removeClass("active"),e.state.modelOpen=!1,e.state.id=!1}),550)})),t("body").on("click","#nectar-menu-settings-modal > .header .categories a",(function(n){n.preventDefault();const i=t(this).attr("data-rel"),s=t(this);e.state.modelOpen&&(e.state.category=i,e.$modal.find(".header .categories a").removeClass("active"),s.addClass("active"),e.$modal.find(".setting-field").hide(),e.$modal.find('.setting-field[data-cat="'+i+'"]:not(.dep-hidden)').show(),e.$modal.find(".nectar-setting-dropdown[data-toggles] select, .nectar-setting-dropdown[data-icon-container] select").trigger("change"),e.$modal.find('.nectar-setting-switch_toggle[data-toggles] .switch-options.salient input[type="hidden"]').trigger("change"))})),t(document).on("menu-item-added",this.createDomEls.bind(this))},n.prototype.fieldsInit=function(){this.fieldSwitch(),this.fieldImageUpload(),this.fieldVideoUpload(),this.fieldIcon(),this.fieldDropdownToggle(),this.fieldNumerical(),this.fieldAlignment(),this.fieldColor()},n.prototype.fieldColor=function(){this.$modalInner.find(".nectar-option-colorpicker input.popup-colorpicker").wpColorPicker({palettes:[nectar_menu.colors.color1,nectar_menu.colors.color2,nectar_menu.colors.color3,nectar_menu.colors.color4,nectar_menu.colors.color5,nectar_menu.colors.color6]})},n.prototype.fieldAlignment=function(){this.$modalInner.find(".nectar-setting-alignment .selection span").on("click",(function(){t(this).closest(".nectar-setting-alignment").find('.setting input[type="hidden"]').val(t(this).attr("data-pos")),t(this).siblings("span").removeClass("active"),t(this).addClass("active")}))},n.prototype.fieldSwitch=function(){const e=this;e.$modalInner.find(".switch-options.salient .cb-enable").on("click",(function(){const e=t(this).parents(".switch-options");t(".cb-disable",e).removeClass("selected"),t(this).addClass("selected"),t(this).parent().addClass("activated"),t('input[type="hidden"]',e).val("on"),t('input[type="hidden"]',e).trigger("change")})),e.$modalInner.find(".switch-options.salient .cb-disable").on("click",(function(){const e=t(this).parents(".switch-options");t(".cb-enable",e).removeClass("selected"),t(this).addClass("selected"),t(this).parent().removeClass("activated"),t('input[type="hidden"]',e).val(""),t('input[type="hidden"]',e).trigger("change")})),e.$modalInner.find('.switch-options.salient input[type="hidden"]').on("change",(function(n){const i=t(this).parents(".nectar-setting-switch_toggle");if(t(this).parents(".setting-field").attr("data-cat")===e.state.category&&i.is("[data-toggles]")){const n=i.attr("data-toggles");"on"==t(this).val()?e.$modalInner.find('[id*="'+n+'"]').parents(".setting-field").show():e.$modalInner.find('[id*="'+n+'"]').parents(".setting-field").hide()}}))},n.prototype.fieldNumerical=function(){const e=[];this.$modalInner.find("input.nectar-numerical").each((function(n){e[n]=new i(t(this))}))},n.prototype.fieldDropdownToggle=function(){const e=this;e.$modalInner.find(".nectar-setting-dropdown[data-toggles]").each((function(){const n=t(this);t(this).find(".setting select").on("change",(function(){if(t(this).parents(".setting-field").attr("data-cat")!==e.state.category)return;const i=t(this).val(),s=t(this).attr("name");e.$modalInner.find('[id*="'+n.attr("data-toggles")+'"]').parents(".setting-field").hide().addClass("dep-hidden"),e.$modalInner.find("[data-toggled-by]").each((function(){if(t(this).attr("data-toggled-by")===s){t(this).hide();let e=t(this).attr("data-toggled-by-value");e=e.split(","),e.includes(i)&&t(this).show()}})),e.$modalInner.find('[id*="'+n.attr("data-toggles")+"_"+i+'"]').length>0&&e.$modalInner.find('[id*="'+n.attr("data-toggles")+"_"+i+'"]').parents(".setting-field").show().removeClass("dep-hidden")})).trigger("change")}))},n.prototype.fieldIcon=function(){const e=this;e.$modalInner.find(".nectar-setting-dropdown[data-icon-container]").each((function(){const n=e.$modalInner.find("#"+t(this).attr("data-icon-container")).parents(".setting-field"),i=e.$modalInner.find("#"+t(this).attr("data-iconsmind-container")).parents(".setting-field"),s=e.$modalInner.find("#"+t(this).attr("data-icon-custom")).parents(".setting-field"),a=e.$modalInner.find("#"+t(this).attr("data-icon-custom-text")).parents(".setting-field"),d=e.$modalInner.find("#"+t(this).attr("data-icon-custom-border-radius")).parents(".setting-field");t(this).find(".setting select").on("change",(function(){if(t(this).parents(".setting-field").attr("data-cat")!==e.state.category)return;const r=t(this).val();"font_awesome"===r?(n.show().removeClass("dep-hidden"),i.hide().addClass("dep-hidden"),a.hide().addClass("dep-hidden"),s.hide().addClass("dep-hidden"),d.hide().addClass("dep-hidden")):"custom"===r?(n.hide().addClass("dep-hidden"),i.hide().addClass("dep-hidden"),a.hide().addClass("dep-hidden"),s.show().removeClass("dep-hidden"),d.show().removeClass("dep-hidden")):"custom_text"===r?(n.hide().addClass("dep-hidden"),i.hide().addClass("dep-hidden"),s.hide().addClass("dep-hidden"),d.hide().addClass("dep-hidden"),a.show().removeClass("dep-hidden")):"iconsmind"===r?(n.hide().addClass("dep-hidden"),i.show().removeClass("dep-hidden"),s.hide().addClass("dep-hidden"),d.hide().addClass("dep-hidden"),a.hide().addClass("dep-hidden")):(i.hide().addClass("dep-hidden"),n.hide().addClass("dep-hidden"),s.hide().addClass("dep-hidden"),a.hide().addClass("dep-hidden"),d.hide().addClass("dep-hidden"))})).trigger("change")})),e.$modalInner.find(".nectar-icon-container").each((function(){const e=t(this),n=t(this).parent().find('input[type="hidden"]'),i=t(this).parent().find(".selected-icon"),s=t(this).parent().find(".selected-icon span");t(this).find("> span").on("click",(function(){const e=t(this).find("> i");n.val(e.attr("class")),t(this).siblings("span").removeClass("active"),t(this).addClass("active"),i.removeClass("hidden"),s.html('<i class="'+e.attr("class")+'"></i>')})),i.find("a").on("click",(function(){return n.val(""),s.html(""),e.find("span").removeClass("active"),t(this).parent().addClass("hidden"),!1}))})),e.$modalInner.find('.nectar-setting-icon input[name="icon_search"]').each((function(){t(this).on("keyup",(function(){const e=t(this).val().toLowerCase(),n=t(this).parents(".nectar-setting-icon").find(".nectar-icon-container span");if(0==e.length)return n.removeClass("hidden"),!0;n.each((function(){-1!=t(this).find("i").attr("class").toLowerCase().indexOf(e)?t(this).removeClass("hidden"):t(this).addClass("hidden")}))}))}))},n.prototype.fieldVideoUpload=function(){this.$modalInner.find(".nectar-add-video-btn").on("click",(function(e){const n=t(this);let i=null;i=wp.media.frames.customHeader=wp.media({title:t(this).data("choose"),library:{type:"video"},button:{text:t(this).data("update")}}),i.on("select",(function(){const e=i.state().get("selection").first();t("#"+n.attr("rel-id")).val(e.attributes.url).trigger("change"),t("#_nectar_video_embed").trigger("keyup"),n.parent().find(".nectar-add-video-btn").hide(),n.parent().find(".nectar-remove-video-btn").css("display","inline-block")})),i.open()})),this.$modalInner.find(".nectar-remove-video-btn").on("click",(function(e){e.preventDefault(),t("#"+t(this).attr("rel-id")).val(""),t(this).parents(".setting-field").find(".nectar-add-video-btn").css("display","inline-block"),t(this).css("display","none")}))},n.prototype.fieldImageUpload=function(){this.$modalInner.find(".nectar-add-btn").on("click",(function(e){const n=t(this);e.preventDefault();let i=null;i=wp.media.frames.customHeader=wp.media({title:t(this).attr("data-title"),library:{type:"image"},button:{text:t(this).attr("data-update")}}),i.on("select",(function(){const e=i.state().get("selection").first(),s=e.attributes.url,a=e.attributes.id;n.parent().find(".nectar-media-preview").attr("src",s),t("#"+n.attr("rel-id")+"-url").val(s).trigger("change"),t("#"+n.attr("rel-id")+"-id").val(a).trigger("change"),n.parent().find(".nectar-add-btn").css({display:"none"}),n.parent().find(".nectar-media-preview").show(),n.parent().find(".nectar-remove-btn").css({display:"inline-block"})})),i.open()})),this.$modalInner.find(".nectar-remove-btn").on("click",(function(e){e.preventDefault(),t("#"+t(this).attr("rel-id")+"-url").val(""),t("#"+t(this).attr("rel-id")+"-id").val(""),t(this).parents(".setting").find(".nectar-add-btn").css({display:"inline-block"}),t(this).parent().find(".nectar-media-preview").hide(),t(this).css({display:"none"})}))},t.fn.serializeFormWithArrs=function(){const e={};function n(t,e){if(t.length<1)return e;let i=t[0];"]"==i.slice(-1)&&(i=i.slice(0,-1));const s={};if(1==t.length)s[i]=e;else{t.shift();const a=n(t,e);s[i]=a}return s}return t.each(this.serializeArray(),(function(){const i=this.value,s=n(this.name.split("["),i);t.extend(!0,e,s)})),e},i.prototype.events=function(){this.connectedUnitsEl&&this.connectedUnitsEl.on("change",this.rateAdjustmentUpdate.bind(this))},i.prototype.rateAdjustmentUpdate=function(){const t=this;this.rateAdjustment=6,this.connectedUnitsEl&&"px"===this.connectedUnitsEl.val()&&(t.rateAdjustment=2)},i.prototype.createMarkup=function(){this.$el.parents(".setting").addClass("nectar-numerical-setting"),this.$el.parent().append('<span class="scrubber" />'),this.$scrubber=this.$el.parents(".numerical-input-wrap").find(".scrubber"),this.$scrubber.append('<span class="inner"/>'),this.$scrubber.find(".inner").append("<span />"),this.$scrubber.append('<i class="dashicons dashicons-arrow-left-alt2" />'),this.$scrubber.append('<i class="dashicons dashicons-arrow-right-alt2" />'),this.$scrubberIndicator=this.$scrubber.find(".inner span")},i.prototype.scrubbing=function(){const n=this;this.$scrubber.on("mousedown",(function(){if(t('#nectar-menu-settings-modal .setting-field[class*="nectar-setting-numerical"]').addClass("no-scrubbing"),n.$el.parents(".setting-field").removeClass("no-scrubbing").addClass("scrubbing"),e.mouseUp=!1,n.initialX=e.mouseX,0==n.$el.val().length)this.scrubberCurrent=0,n.currentVal=0;else{if(n.currentVal=n.$el.val(),"none"!=n.$scrubberIndicator.css("transform")){const t=n.$scrubberIndicator.css("transform").replace(/[^0-9\-.,]/g,"").split(",");n.scrubberCurrent=t[12]||t[4]}isNaN(parseInt(n.currentVal))&&(n.currentVal="0")}requestAnimationFrame(n.scrubbingAlter.bind(n))}))},i.prototype.scrubbingAlter=function(t){1!=e.mouseUp&&requestAnimationFrame(this.scrubbingAlter.bind(this)),this.calculatedVal=parseInt(this.currentVal)+parseInt(e.mouseX-this.initialX)/this.rateAdjustment,this.calculatedVal=Math.floor(this.calculatedVal),this.zeroFloor&&this.calculatedVal<0?this.$el.val(0):this.calculatedVal>this.ceil?this.$el.val(this.ceil):(this.$el.val(this.calculatedVal),this.scrubberIndicatorX=(1-.14)*this.scrubberIndicatorX+.14*(parseInt(this.scrubberCurrent)+parseInt(e.mouseX-this.initialX)/4),this.$scrubberIndicator.css({transform:"translate3d("+this.scrubberIndicatorX+"px, 0px, 0px)"}))},jQuery(document).ready((function(t){new n}))}(jQuery)})();