document.addEventListener("DOMContentLoaded",()=>{let d="V2",l="V3",e="https://www.google.com/recaptcha/api.js",i=window.uicoreBlockForms?.recaptchaKey||"",m={},r=document.querySelectorAll("form[data-form-page]"),u=null,n={required:e=>""!==e.trim(),minLength:(e,r)=>e.trim().length>=r,maxLength:(e,r)=>e.trim().length<=r,pattern:(e,r)=>new RegExp(r).test(e),email:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),url:e=>{try{return new URL(e),!0}catch{return!1}},number:e=>""!==e.trim()&&!isNaN(e),min:(e,r)=>!isNaN(e)&&parseFloat(e)>=r,max:(e,r)=>!isNaN(e)&&parseFloat(e)<=r,step:(e,r,a=0)=>{var e=parseFloat(e);return!isNaN(e)&&(e=(e-a)/r,Math.abs(e-Math.round(e))<Number.EPSILON)},checkboxRequired:e=>e.checked,radioRequired:e=>Array.from(e).some(e=>e.checked)},p=(e,r=!1)=>{let a=e.target.closest(".uicore-bl-wrp");a&&(r?setTimeout(()=>{a.classList.remove("ui-bl-form-loading")},500):a.classList.add("ui-bl-form-loading"))};var a,t;let h=(e,r="error",a="",t=!0)=>{e.querySelectorAll(".uicore-form-message").forEach(e=>e.remove());a=Array.isArray(a)?a:[a];let o=document.createElement("span");o.className="uicore-form-message uicore-form-message-"+r,a.forEach(e=>{var r=document.createElement("p");r.textContent=e,o.appendChild(r)}),e.appendChild(o),t&&setTimeout(()=>o.remove(),1e4)},s=async({payload:e,baseUrl:r,form:a,formId:t,event:o,token:c})=>{c&&(e.grecaptcha_token=c,e.grecaptcha_version=u);try{var l=await(await fetch(r+"uicore-blocks/v1/form-submission",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(l.success){a.reset();let{redirect:e,message:r}=l.data||{};var s=e?.url?e.message||"Redirecting...":r||"Your submission was successful.";h(a,"success",s),e?.url&&setTimeout(()=>{window.location.href=e.url},e.delay||0)}else{var i=l.data||{},n=[i.message||"There is a server error. Please try again later.",...Object.entries(i).filter(([e,r])=>"message"!==e&&r?.message).map(([,e])=>e.message)];h(a,"error",n),u===d&&window.grecaptcha&&window.grecaptcha.reset(m[t])}}catch(e){h(a,"error","There is a server error. Please try again later."),u===d&&window.grecaptcha&&window.grecaptcha.reset(m[t])}finally{p(o,!0)}},o=async a=>{a.preventDefault();let t=a.target.closest("form"),o=(p(a),t.className.match(/uicore-block-(\w+)/)?.[1]),{baseUrl:c=""}=window.uicoreBlockForms||{};var e=t.dataset.formPage;if(o&&c&&e&&(e=>{let s=!0;var r;return e.querySelectorAll(".wp-block-uicore-form-field:not(.uicore-bl-error)").forEach(e=>{var r=e.querySelector("input,textarea,select");if(r){var a,t,o=r.value.trim();e.querySelectorAll(".uicore-bl-error").forEach(e=>{e.style.display="none"});for([a,t]of Object.entries(e.dataset))if(a.startsWith("validate")&&"false"!==t){var c=a.slice(8).replace(/^./,e=>e.toLowerCase()),l=n[c];if(!(1<l.length?l(o,Number(t)||t):l(o))){l=e.querySelector(`.uicore-bl-error[data-validate="${c}"]`);l&&(l.style.display="block"),s=!1;break}}}}),u===d&&i&&window.grecaptcha&&(r=e.className.match(/uicore-block-(\w+)/)?.[1],window.grecaptcha.getResponse(m[r])||(e.querySelector('[data-recaptcha-version="V2"]').closest(".wp-block-uicore-form-field").querySelector('.uicore-bl-error[data-validate="required"]').style.setProperty("display","block"),s=!1)),s})(t)){let r={blockId:o,postId:e,formData:Object.fromEntries(new FormData(t).entries())};u===l&&window.grecaptcha?window.grecaptcha.ready(()=>{window.grecaptcha.execute(i,{action:"submit"}).then(e=>{!e||e.length<10?(h(t,"error","Spam validation failed. Please try again."),p(a,!0)):s({payload:r,baseUrl:c,form:t,token:e,formId:o,event:a})}).catch(()=>{h(t,"error","Spam validation failed. Please try again."),s({payload:r,baseUrl:c,form:t,formId:o,event:a})})}):u===d&&window.grecaptcha?!(e=window.grecaptcha.getResponse(m[o]))||e.length<10?(h(t,"error","Spam validation failed. Please try again."),p(a,!0)):await s({payload:r,baseUrl:c,form:t,token:e,formId:o,event:a}):await s({payload:r,baseUrl:c,form:t,formId:o,event:a})}else p(a,!0)};a=Array.from(r).some(e=>e.querySelector('[data-recaptcha-version="V3"]')),t=Array.from(r).some(e=>e.querySelector('[data-recaptcha-version="V2"]')),a&&i?(u=l,r.forEach(e=>{e.querySelector('[data-recaptcha-version="V3"]')?.closest(".wp-block-uicore-form-field")?.style.setProperty("display","none","important")})):t&&i&&(u=d),r.forEach(e=>{e.querySelectorAll("input, select, textarea").forEach(r=>{var e=r.closest(".wp-block-uicore-form-field, .wp-block-uicore-checkbox");if(e){let a=[e,r,...e.querySelectorAll('[class^="wp-block-uicore-"]')];["focus","blur"].forEach(e=>r.addEventListener(e,()=>{let r="focus"===e;a.forEach(e=>e.classList.toggle("uicore-is-active",r))}))}})}),i&&u&&(a=u===l?e+"?render="+i:e+"?onload=uicoreRecaptchaOnload&render=explicit",(t=document.createElement("script")).src=a,t.async=!0,t.defer=!0,document.head.appendChild(t),u===d)&&(window.uicoreRecaptchaOnload=()=>{r.forEach(e=>{var r=e.querySelector('[data-recaptcha-version="V2"]');r&&(e=e.className.match(/uicore-block-(\w+)/)?.[1])&&(m[e]=window.grecaptcha.render(r,{sitekey:i,theme:"light",size:"normal"}))})}),document.querySelectorAll("form .uicore-bl-wrp").forEach(e=>e.addEventListener("click",o))});